# 시스템 아키텍처 설계서

**작성일**: 2025-10-13  
**문서명**: 251013_설계 - 시스템 아키텍처 설계서 v1.0.md  
**프로젝트**: 스마트 단어장 (Smart Vocabulary Builder)  
**설계자**: AI Software Student Team

---

## 1. 기술 스택 요약

| 구분 | 선택 기술 | 사유 |
|------|----------|------|
| GUI 프레임워크 | PyQt5 | 현대적 UI, 풍부한 위젯, Qt Designer 활용 가능 |
| 아키텍처 패턴 | MVC 기반 모듈별 분리 | 책임 분리 + 모듈 독립성 확보 |
| 데이터베이스 | SQLite3 (Raw SQL) | 단순성, 성능, 직접 제어 가능 |
| 설정 관리 | DB (user_settings 테이블) | 통합 백업, 일관된 관리 |
| 로깅 | Python logging 모듈 | 표준 라이브러리, 레벨별 관리 |
| 패키징 | PyInstaller | exe 파일 생성 |

---

## 2. 아키텍처 패턴: MVC 기반 모듈별 분리

### 2.1 전체 구조도

```
┌──────────────────────────────────────────────────────────┐
│                     Main Application                      │
│                       (main.py)                          │
└────────────────────┬─────────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
┌───────▼────────┐       ┌───────▼────────┐
│   View (UI)    │◄─────►│   Controller   │
│   (PyQt5)      │       │   (비즈니스    │
└───────┬────────┘       │    로직)       │
        │                └───────┬────────┘
        │                        │
        │                ┌───────▼────────┐
        │                │   Model        │
        │                │   (데이터 접근)│
        │                └───────┬────────┘
        │                        │
        └────────────────────────▼────────────────────────┐
                          Database (SQLite3)              │
                          vocabulary.db                   │
                          └─────────────────────────────────┘
```

### 2.2 MVC 패턴 적용 방식

**Model (데이터 계층)**
- 데이터베이스 직접 접근
- CRUD 연산 수행
- 데이터 검증 및 반환

**View (화면 계층)**
- PyQt5 위젯으로 UI 구성
- 사용자 입력 수신
- 데이터 표시

**Controller (제어 계층)**
- View와 Model 연결
- 비즈니스 로직 처리
- 데이터 가공 및 전달

---

## 3. 프로젝트 디렉토리 구조

```
smart_vocab_builder/
├── main.py                          # 애플리케이션 진입점
├── config.py                        # 전역 설정 상수
├── requirements.txt                 # 외부 라이브러리 목록
│
├── database/                        # 데이터베이스 관련
│   ├── __init__.py
│   ├── db_connection.py             # DB 연결 관리 (Singleton)
│   ├── schema.sql                   # 테이블 생성 DDL
│   └── init_data.sql                # 초기 데이터 (user_settings)
│
├── models/                          # Model (데이터 접근 계층)
│   ├── __init__.py
│   ├── base_model.py                # 공통 DB 연산 베이스 클래스
│   ├── word_model.py                # 단어 CRUD
│   ├── learning_model.py            # 학습 이력 CRUD
│   ├── exam_model.py                # 시험 CRUD
│   ├── statistics_model.py          # 통계 조회
│   └── settings_model.py            # 설정 CRUD
│
├── controllers/                     # Controller (비즈니스 로직 계층)
│   ├── __init__.py
│   ├── word_controller.py           # 단어 관리 로직
│   ├── flashcard_controller.py      # 플래시카드 학습 로직
│   ├── exam_controller.py           # 시험 로직
│   ├── statistics_controller.py     # 통계 계산 로직
│   └── settings_controller.py       # 설정 관리 로직
│
├── views/                           # View (UI 계층 - PyQt5)
│   ├── __init__.py
│   ├── main_window.py               # 메인 윈도우 (탭 컨테이너)
│   │
│   ├── word_management/             # 단어 관리 모듈
│   │   ├── __init__.py
│   │   ├── word_list_view.py        # 단어 목록 화면
│   │   ├── word_edit_dialog.py      # 단어 추가/수정 다이얼로그
│   │   └── word_import_dialog.py    # CSV 임포트 다이얼로그
│   │
│   ├── flashcard/                   # 플래시카드 모듈
│   │   ├── __init__.py
│   │   ├── flashcard_view.py        # 플래시카드 학습 화면
│   │   └── flashcard_settings_dialog.py  # 학습 설정 다이얼로그
│   │
│   ├── exam/                        # 시험 모듈
│   │   ├── __init__.py
│   │   ├── exam_setup_view.py       # 시험 설정 화면
│   │   ├── exam_taking_view.py      # 시험 진행 화면
│   │   ├── exam_result_view.py      # 시험 결과 화면
│   │   └── wrong_note_view.py       # 오답 노트 화면
│   │
│   ├── statistics/                  # 통계 모듈
│   │   ├── __init__.py
│   │   ├── statistics_view.py       # 통계 대시보드
│   │   └── charts.py                # 차트 위젯 (matplotlib 연동)
│   │
│   └── settings/                    # 설정 모듈
│       ├── __init__.py
│       └── settings_view.py         # 설정 화면
│
├── utils/                           # 유틸리티
│   ├── __init__.py
│   ├── logger.py                    # 로깅 설정
│   ├── validators.py                # 입력 검증 (단어, 점수 등)
│   ├── csv_handler.py               # CSV 임포트/엑스포트
│   └── datetime_helper.py           # 날짜/시간 처리
│
├── resources/                       # 리소스 파일
│   ├── icons/                       # 아이콘 이미지
│   ├── styles/                      # QSS 스타일시트 (테마)
│   │   ├── light_theme.qss
│   │   └── dark_theme.qss
│   └── vocabulary.db                # SQLite 데이터베이스 파일
│
├── logs/                            # 로그 파일 디렉토리
│   └── app.log                      # 애플리케이션 로그
│
└── tests/                           # 테스트 코드
    ├── __init__.py
    ├── test_models.py               # Model 단위 테스트
    ├── test_controllers.py          # Controller 단위 테스트
    └── test_integration.py          # 통합 테스트
```

---

## 4. 핵심 클래스 설계

### 4.1 Model 계층

#### base_model.py
```python
class BaseModel:
    """
    모든 Model 클래스의 베이스 클래스
    공통 DB 연산 메서드 제공
    """
    def __init__(self):
        self.db = DBConnection.get_instance()
    
    def execute_query(self, query, params=None):
        """SQL 실행 (SELECT)"""
        pass
    
    def execute_update(self, query, params=None):
        """SQL 실행 (INSERT/UPDATE/DELETE)"""
        pass
```

#### word_model.py
```python
class WordModel(BaseModel):
    """
    단어 데이터 접근 클래스
    """
    def get_all_words(self):
        """전체 단어 조회"""
        pass
    
    def get_word_by_id(self, word_id):
        """단어 ID로 조회"""
        pass
    
    def search_words(self, keyword, search_type):
        """단어 검색 (영어/한국어/메모)"""
        pass
    
    def add_word(self, english, korean, memo=None):
        """단어 추가"""
        pass
    
    def update_word(self, word_id, **kwargs):
        """단어 수정"""
        pass
    
    def delete_word(self, word_id):
        """단어 삭제"""
        pass
    
    def toggle_favorite(self, word_id):
        """즐겨찾기 토글"""
        pass
    
    def import_from_csv(self, csv_data):
        """CSV에서 단어 일괄 추가"""
        pass
    
    def export_to_csv(self):
        """전체 단어 CSV 내보내기"""
        pass
```

#### learning_model.py
```python
class LearningModel(BaseModel):
    """
    학습 이력 데이터 접근 클래스
    """
    def create_session(self, session_type, study_mode):
        """학습 세션 생성"""
        pass
    
    def end_session(self, session_id, stats):
        """학습 세션 종료 (통계 업데이트)"""
        pass
    
    def add_learning_history(self, session_id, word_id, is_correct, **kwargs):
        """학습 이력 추가"""
        pass
    
    def get_session_history(self, session_id):
        """세션별 학습 이력 조회"""
        pass
```

#### exam_model.py
```python
class ExamModel(BaseModel):
    """
    시험 데이터 접근 클래스
    """
    def create_exam(self, exam_type, question_mode, total_questions, **kwargs):
        """시험 생성"""
        pass
    
    def save_exam_question(self, exam_id, word_id, question_number, **kwargs):
        """시험 문제 저장"""
        pass
    
    def finish_exam(self, exam_id, score, time_taken):
        """시험 종료"""
        pass
    
    def get_exam_history(self, limit=10):
        """시험 이력 조회"""
        pass
    
    def get_exam_detail(self, exam_id):
        """시험 상세 조회 (문제별)"""
        pass
```

#### statistics_model.py
```python
class StatisticsModel(BaseModel):
    """
    통계 데이터 접근 클래스
    """
    def get_word_statistics(self, word_id):
        """단어별 통계 조회"""
        pass
    
    def update_word_statistics(self, word_id, is_correct):
        """단어 통계 업데이트 (학습 후 호출)"""
        pass
    
    def get_daily_statistics(self, date):
        """일일 학습 통계"""
        pass
    
    def get_weekly_statistics(self, start_date, end_date):
        """주간 학습 통계"""
        pass
    
    def get_top_wrong_words(self, limit=20):
        """오답률 높은 단어 Top N"""
        pass
```

#### settings_model.py
```python
class SettingsModel(BaseModel):
    """
    설정 데이터 접근 클래스
    """
    def get_setting(self, key):
        """설정 값 조회"""
        pass
    
    def set_setting(self, key, value):
        """설정 값 변경"""
        pass
    
    def get_all_settings(self):
        """전체 설정 조회 (딕셔너리 반환)"""
        pass
```

---

### 4.2 Controller 계층

#### word_controller.py
```python
class WordController:
    """
    단어 관리 비즈니스 로직
    """
    def __init__(self):
        self.word_model = WordModel()
    
    def get_word_list(self, filter_favorite=False):
        """단어 목록 조회 (필터 적용)"""
        pass
    
    def search_words(self, keyword, search_in):
        """단어 검색"""
        pass
    
    def add_new_word(self, english, korean, memo=None):
        """단어 추가 (검증 포함)"""
        # 1. 입력 검증 (validators 사용)
        # 2. 중복 체크
        # 3. Model 호출
        pass
    
    def update_word(self, word_id, **kwargs):
        """단어 수정"""
        pass
    
    def delete_word(self, word_id):
        """단어 삭제 (확인 후)"""
        pass
    
    def import_words_from_csv(self, file_path):
        """CSV 임포트 (중복 처리, 오류 처리)"""
        pass
    
    def export_words_to_csv(self, file_path):
        """CSV 내보내기"""
        pass
```

#### flashcard_controller.py
```python
class FlashcardController:
    """
    플래시카드 학습 비즈니스 로직
    """
    def __init__(self):
        self.word_model = WordModel()
        self.learning_model = LearningModel()
        self.statistics_model = StatisticsModel()
    
    def start_flashcard_session(self, mode, order):
        """
        플래시카드 세션 시작
        mode: 'en_to_ko' | 'ko_to_en'
        order: 'sequential' | 'random' | 'personalized'
        """
        # 1. 세션 생성
        # 2. 단어 목록 가져오기
        # 3. 순서 결정 (개인화의 경우 오답률 기반 정렬)
        pass
    
    def get_next_word(self):
        """다음 단어 가져오기"""
        pass
    
    def submit_answer(self, word_id, user_answer, response_time):
        """답변 제출 및 정답 확인"""
        # 1. 정답 여부 확인
        # 2. 학습 이력 저장
        # 3. 통계 업데이트
        pass
    
    def end_session(self):
        """세션 종료 및 결과 반환"""
        pass
```

#### exam_controller.py
```python
class ExamController:
    """
    시험 비즈니스 로직
    """
    def __init__(self):
        self.word_model = WordModel()
        self.exam_model = ExamModel()
        self.statistics_model = StatisticsModel()
    
    def create_exam(self, exam_type, question_mode, num_questions, order):
        """
        시험 생성
        exam_type: 'short_answer' | 'multiple_choice'
        question_mode: 'en_to_ko' | 'ko_to_en'
        order: 'random' | 'personalized'
        """
        # 1. 단어 선택 (개인화의 경우 오답률 높은 단어 우선)
        # 2. 객관식의 경우 오답 선택지 생성
        # 3. 시험 DB 저장
        pass
    
    def submit_exam_answer(self, question_id, user_answer):
        """시험 답안 제출"""
        pass
    
    def finish_exam(self, exam_id):
        """시험 종료 및 채점"""
        # 1. 점수 계산
        # 2. 오답 노트에 자동 추가
        # 3. 통계 업데이트
        pass
    
    def get_exam_result(self, exam_id):
        """시험 결과 조회"""
        pass
```

#### statistics_controller.py
```python
class StatisticsController:
    """
    통계 비즈니스 로직
    """
    def __init__(self):
        self.statistics_model = StatisticsModel()
    
    def get_today_summary(self):
        """오늘의 학습 요약"""
        pass
    
    def get_weekly_progress(self):
        """주간 학습 진척도"""
        pass
    
    def get_learning_trend(self, days=7):
        """학습 추세 (차트용 데이터)"""
        pass
    
    def get_mastery_distribution(self):
        """숙지도 분포"""
        pass
    
    def calculate_goal_achievement(self):
        """학습 목표 달성률"""
        pass
```

---

### 4.3 View 계층 (PyQt5)

#### main_window.py
```python
class MainWindow(QMainWindow):
    """
    메인 윈도우 - 탭 기반 UI
    """
    def __init__(self):
        super().__init__()
        self.init_ui()
    
    def init_ui(self):
        """UI 초기화"""
        # 1. 윈도우 설정
        # 2. 메뉴바 생성
        # 3. 탭 위젯 생성
        #    - 단어 관리 탭
        #    - 플래시카드 탭
        #    - 시험 탭
        #    - 통계 탭
        #    - 설정 탭
        # 4. 상태바
        pass
    
    def load_theme(self):
        """테마 로드 (QSS)"""
        pass
```

#### word_list_view.py
```python
class WordListView(QWidget):
    """
    단어 목록 화면
    """
    def __init__(self, controller):
        super().__init__()
        self.controller = controller  # WordController
        self.init_ui()
    
    def init_ui(self):
        """UI 초기화"""
        # 1. 검색바
        # 2. 필터 (즐겨찾기, 카테고리)
        # 3. 단어 테이블 (QTableWidget)
        # 4. 버튼 (추가, 수정, 삭제, 임포트, 엑스포트)
        pass
    
    def load_words(self):
        """단어 목록 로드"""
        words = self.controller.get_word_list()
        # 테이블에 표시
        pass
    
    def on_add_word_clicked(self):
        """단어 추가 버튼 클릭"""
        dialog = WordEditDialog(mode='add')
        if dialog.exec_():
            word_data = dialog.get_data()
            self.controller.add_new_word(**word_data)
            self.load_words()
        pass
```

#### flashcard_view.py
```python
class FlashcardView(QWidget):
    """
    플래시카드 학습 화면
    """
    def __init__(self, controller):
        super().__init__()
        self.controller = controller  # FlashcardController
        self.init_ui()
    
    def init_ui(self):
        """UI 초기화"""
        # 1. 학습 모드 선택 (영→한, 한→영)
        # 2. 출제 방식 선택 (순차, 랜덤, 개인화)
        # 3. 카드 표시 영역
        # 4. 답변 입력 또는 답 보기 버튼
        # 5. 진행 상황 표시 (5/20)
        pass
    
    def start_learning(self):
        """학습 시작"""
        pass
    
    def show_next_card(self):
        """다음 카드 표시"""
        pass
    
    def check_answer(self):
        """답변 확인"""
        pass
```

---

## 5. 데이터 흐름 예시

### 5.1 단어 추가 시나리오

```
[사용자 액션]
    ↓
[View] WordListView.on_add_word_clicked()
    ↓
[View] WordEditDialog.exec_() → 사용자 입력 수신
    ↓
[Controller] WordController.add_new_word(english, korean, memo)
    ↓ (검증)
    ↓
[Model] WordModel.add_word(english, korean, memo)
    ↓ (SQL INSERT)
    ↓
[Database] words 테이블에 삽입
    ↓
[Controller] 성공 반환
    ↓
[View] 단어 목록 새로고침
```

### 5.2 플래시카드 학습 시나리오

```
[사용자 액션] 학습 시작 버튼 클릭
    ↓
[View] FlashcardView.start_learning()
    ↓
[Controller] FlashcardController.start_flashcard_session(mode, order)
    ↓
[Model] LearningModel.create_session()
    ↓
[Model] WordModel.get_all_words() + 정렬
    ↓
[Controller] 단어 목록 반환
    ↓
[View] 첫 번째 카드 표시
    ↓
[사용자 액션] 답변 입력
    ↓
[View] FlashcardView.check_answer()
    ↓
[Controller] FlashcardController.submit_answer()
    ↓
[Model] LearningModel.add_learning_history()
[Model] StatisticsModel.update_word_statistics()
    ↓
[View] 정답/오답 피드백 표시
    ↓
[View] 다음 카드 표시
    ↓
... (반복)
    ↓
[Controller] FlashcardController.end_session()
    ↓
[Model] LearningModel.end_session()
    ↓
[View] 학습 결과 표시
```

---

## 6. 설계 검토 및 추가 제안

### ✅ 결정 사항 반영 확인

1. **GUI 프레임워크 (PyQt5)** ✅
   - `views/` 디렉토리에 PyQt5 기반 UI 클래스 배치
   - QMainWindow, QWidget, QDialog 활용
   - QSS 스타일시트로 테마 관리

2. **아키텍처 패턴 (MVC 기반 모듈별 분리)** ✅
   - Model: `models/` - 데이터 접근
   - View: `views/` - UI (기능별 서브모듈 분리)
   - Controller: `controllers/` - 비즈니스 로직
   - 각 기능(단어, 학습, 시험, 통계)별로 MVC 세트 구성

3. **데이터베이스 접근 (Raw SQL + sqlite3)** ✅
   - `database/db_connection.py`에서 Singleton 패턴으로 연결 관리
   - Model에서 직접 SQL 쿼리 실행
   - Parameterized Query로 SQL Injection 방어

4. **설정 관리 (데이터베이스)** ✅
   - `user_settings` 테이블 활용
   - `SettingsModel` + `SettingsController`로 관리
   - Key-Value 구조로 유연한 설정 저장

5. **로깅 (Python logging)** ✅
   - `utils/logger.py`에서 logging 설정
   - 파일 로그 (`logs/app.log`) + 콘솔 로그
   - 레벨별 로그 (DEBUG, INFO, WARNING, ERROR, CRITICAL)

